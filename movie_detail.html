<!DOCTYPE html>
{% autoescape false %}

<html>


<head>
	<link rel="shortcut icon" href="images/favicon.ico" />
	<link rel="stylesheet" type="text/css" href="/stylesheets/movie_detail_style.css?v=1">
	<link type="text/css" rel="stylesheet" href="/stylesheets/font_family.css" />
	<link type="text/css" rel="stylesheet" href="/stylesheets/main_header.css" />
    <link type="text/css" rel="stylesheet" href="/stylesheets/base_document.css" />
    <link type="text/css" rel="stylesheet" href="/stylesheets/main_body.css" />
    <link type="text/css" rel="stylesheet" href="/stylesheets/style.css" />
    <script src="/javascripts/CookieUtils.js"></script>


	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{ movie_data.name_en|decodeHTML }}</title>
	<meta name="description" content="{{ movie_data.detail_synopsis_en|decodeHTML }}"/>
	<link rel="image_src" href="/detail/{{ movie_data.id }}" />
	
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script type="text/JavaScript">
	function setsmile(what) {
	document.emotion.messages.value = document.emotion.elements.messages.value+" "+what;
	document.emotion.messages.focus();
	}
</script>
</head>


<body>	
{% include "/main_header.html" with context %}



<div class="movie-spece-0"></div>

	<!-- <div class="movie-title-image" style="width:900px; ">  -->
		<!-- clear:both; -->
		<!-- height:450px; -->

<!-- start bg -->
<div class="movie-bg">
<div class="movie-title-image" style="width:900px;">

	<div class="movie-image">
		<!-- <a href="/detail?movie_id={{ movie_data.id }}"> -->
		<a href="/detail/{{ movie_data.id }}">

		<img border="0" src="/image?movie_id={{ movie_data.id }}" width="288" float:left>
		</a>
	</div>

	<div class="movie-title">
		<strong>{{ movie_data.name_en|decodeHTML }}</strong>	
	</div>
			
	<div class="movie-date">
		<strong>{{ movie_data.detail_genre_en }} - {{movie_data.release_time_timestamp|covertUnixTimeToStrFotmat('%d %B %Y')}}</strong>
	</div>

	<div class="movie-rate-total"></div>
	<div class="movie-rate">
		Your rating:

		<img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="1" width="15" height="15" id="star-1"  border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="2" width="15" height="15" id="star-2" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="3" width="15" height="15" id="star-3" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="4" width="15" height="15" id="star-4" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="5" width="15" height="15" id="star-5" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="6" width="15" height="15" id="star-6" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="7" width="15" height="15" id="star-7" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="8" width="15" height="15" id="star-8" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="9" width="15" height="15" id="star-9" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img><img src="/images/details/rate/grey_star_40x38.png" onClick="clickRate(this.alt)" onmouseover="showRateStar(this.alt)" onmouseout="hideRateStar()" alt="10" width="15" height="15" id="star-10" border="0" style="cursor: pointer; padding-right: 1px; padding-left: 1px;"></img>

		<span id="rate-select">-/10</span>
		
		<div class="box-rate-detail">
			<!-- Ratings : 0/10 from 0 users -->
		</div>

		<div class="box-comment-detail">
			<!-- Comments : 0 users -->
		</div>

<!-- 		<div class="box-share">
			<a href="#">want to see</a>
			<a href="#">not interest</a> -->
<!-- 			<a name="fb_share" type="button_count" href="http://www.facebook.com/sharer.php">want to see</a>
			<script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script>
			<a href="#">not interest</a> -->
		<!-- </div> -->
	</div>


	<div class="movie-synopsis-en">
		<strong>{{ movie_data.detail_synopsis_en|decodeHTML }}</strong>
	</div>


	<!-- <div class="movie-director" style="margin: auto; width:550px; height:86px; float:right; color:#666666;"> -->
	<div class="movie-director-writers-stars">
		<div class="movie-director-writers-stars-left">ผู้กำกับ:</div>
		<div class="movie-director-writers-stars-right">{{ movie_data.detail_director_en|decodeHTML }}</div>
		<!-- <strong>Director:{{ movie_data.detail_director_en }}</strong> -->
	</div>


	<div class="movie-director-writers-stars">
		<!-- <strong>Writers:</strong> -->
		<div class="movie-director-writers-stars-left">ผู้เขียนบท:</div>
		<div class="movie-director-writers-stars-right"></div>
	</div>


	<div class="movie-director-writers-stars">
		<div class="movie-director-writers-stars-left">นักแสดง:</div>
		<div class="movie-director-writers-stars-right">{{ movie_data.detail_cast_en|decodeHTML }}</div>
		<script>
			// alert('wqdqwdqwd');
			// var str = {{ movie_data.detail_cast_en }}
			// var n = str.search(", ");

			// alert(str);
		</script>
		<!-- <strong>Stars:{{ movie_data.detail_cast_en}}</strong> -->
	</div>

</div>
<!-- </div> -->
<div class="movie-spece-1"></div>

<div class="movie-synopsis-th"> 
		<h2>เรื่องย่อ</h2>
		<p>
		<div style="color:#666666;">{{ movie_data.detail_synopsis_th|decodeHTML }}</div>
		</p>

		<div style="height: 40px;"></div>
		<iframe id="youtube_frame" src="{{ movie_data.youtube_url }}?autoplay=1&html5=1" frameborder="0" allowfullscreen style="display: none; width: 855px; height: 450px; margin: 0 auto; border: 0;"></iframe>
		<div class="container" style="display: none; margin: 0 auto;">
			<div class="content">
    			<div class="circle"></div>
   				 <div class="circle1"></div>
    		</div>
		</div>

		<script>
		{% if not movie_data.youtube_url %}
			$(".container").show();
			$.getJSON( "/trailer?movie_id={{ movie_data.id }}", function(data) { 
				var youtube_link = "//www.youtube.com/embed/"+data['videoId']+"?autoplay=1&html5=1";
					$("#youtube_frame").get(0).contentWindow.location.replace(youtube_link);
					document.getElementById("youtube_frame").onload = function() {
					$("#youtube_frame").show();
					$(".container").hide();
				};
			});
		{% else %}
			$("#youtube_frame").show();
			$(".container").hide();
		{% endif %}
		</script>
		<div style="height: 20px;"></div>
</div>


<div style="height: 80px;"></div>

<!-- end bg -->
</div> 





<div class="movie-comment">
	
	<div class="movie-box-comment-title"><h2>ความคิดเห็น</h2></div>
	<!-- margin-top:20px; display:block; -->
	<div class="movie-box-comment">

		<form id="form-comment" action="javascript:submitComment();" method="post">
		<div class="movie-box-comment-emotion-avatar">
<!-- 			<div class="movie-box-comment-avatar-title">
				อารม
			</div> -->
			<ul class="tt-wrapper">
<!-- 				<div class="img_avatar_selected1">
					<li><a href="javascript:;" id="1" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar1.png" alt="1" width="57.5" height="57.5" border="0"><span>โหด มันส์ สะใจ</span></a></li>
					<img id="img_avatar_selected1" width="57.5" height="57.5" src="/images/details/avatar_selected1.png" />
				</div>
				
				<div class="img_avatar_selected2">
					<li><a href="javascript:;" id="2" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar2.png" alt="2" width="57.5" height="57.5" border="0"><span>กาก เสียดายตัง</span></a></li>
					<img id="img_avatar_selected2" width="57.5" height="57.5" src="/images/details/avatar_selected2.png" />
				</div> -->


<!-- 				<div class="img_avatar_selected1">
					<li><a href="javascript:;" id="1" onClick="clickAddAvatar(this.id)"><img id="img_avatar_1" src="/images/details/avatar/image_avatar1.png" alt="1" width="57.5" height="57.5" border="0"><span>โหด มันส์ สะใจ</span></a></li>
				</div>
				
				<div class="img_avatar_selected2">
					<li><a href="javascript:;" id="2" onClick="clickAddAvatar(this.id)"><img id="img_avatar_2" src="/images/details/avatar/image_avatar2.png" alt="2" width="57.5" height="57.5" border="0"><span>กาก เสียดายตัง</span></a></li>
				</div> -->


				<li><a href="javascript:;" id="1" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar1.png" alt="1" width="57.5" height="57.5" border="0"><span>โหด มันส์ สะใจ</span></a></li>
				<li><a href="javascript:;" id="2" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar2.png" alt="2" width="57.5" height="57.5" border="0"><span>กาก เสียดายตัง</span></a></li>
				<li><a href="javascript:;" id="3" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar3.png" alt="3" width="57.5" height="57.5" border="0"><span>น่ากลัวสยอง</span></a></li>
				<li><a href="javascript:;" id="4" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar4.png" alt="4" width="57.5" height="57.5" border="0"><span>แนวสัด</span></a></li>
				<li><a href="javascript:;" id="5" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar5.png" alt="5" width="57.5" height="57.5" border="0"><span>สนุกตื่นเต้น</span></a></li>
				<li><a href="javascript:;" id="6" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar6.png" alt="6" width="57.5" height="57.5" border="0"><span>น่าเบื่อจะหลับ</span></a></li>
				<li><a href="javascript:;" id="7" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar7.png" alt="7" width="57.5" height="57.5" border="0"><span>ตลกฮากระจาย</span></a></li>
				<li><a href="javascript:;" id="8" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar8.png" alt="8" width="57.5" height="57.5" border="0"><span>อลังการงานสร้าง</span></a></li>
				<li><a href="javascript:;" id="9" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar9.png" alt="9" width="57.5" height="57.5" border="0"><span>sexy สวย หล่อ น่าหลงไหล</span></a></li>
				<li><a href="javascript:;" id="10" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar10.png" alt="10" width="57.5" height="57.5" border="0"><span>เฉยๆ พอใช้ได้ ดูฆ่าเวลา</span></a></li>
				<li><a href="javascript:;" id="11" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar11.png" alt="11" width="57.5" height="57.5" border="0"><span>เนื้อเรื่องดี ให้แง่คิด</span></a></li>
				<li><a href="javascript:;" id="12" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar12.png" alt="12" width="57.5" height="57.5" border="0"><span>งง ดูไม่รู้เรื่อง</span></a></li>
				<li><a href="javascript:;" id="13" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar13.png" alt="13" width="57.5" height="57.5" border="0"><span>น่ารักเหมาะกับเด็ก</span></a></li>
				<li><a href="javascript:;" id="14" onClick="clickAddAvatar(this.id)"><img src="/images/details/avatar/image_avatar14.png" alt="14" width="57.5" height="57.5" border="0"><span>ซึ้งกินใจ</span></a></li>
			</ul>
		</div>


		<div style="height: 10px;"></div>


		<div class="movie-box-comment-left">
			<!-- <img id="img_avatar2" width="60" height="60" src="/images/details/avatar/image_avatar10.png" /> -->
			<img id="img_avatar" width="60" height="60" src="/images/details/avatar.png" />
			<!-- <img id="img_avatar2" width="60" height="60" src="/images/details/avatar/image_avatar10.png" /> -->

			<!-- <img id="img_avatar_selected" width="60" height="60" src="/images/details/avatar_selected1.png" /> -->
			

<!-- 			<a href="javascript:;" id=":emo1_01:" onClick="clickAddEmo(this.id)"><img src="/images/details/emotion/angry.gif" width="20" height="20" border="0"></a>
			<a href="javascript:;" id=":emo1_02:" onClick="clickAddEmo(this.id)"><img src="/images/details/emotion/cry.gif" width="20" height="20" border="0"></a>
			<a href="javascript:;" id=":emo1_03:" onClick="clickAddEmo(this.id)"><img src="/images/details/emotion/huh.gif" width="20" height="20" border="0"></a>
			<a href="javascript:;" id=":emo1_04:" onClick="clickAddEmo(this.id)"><img src="/images/details/emotion/wink.gif" width="20" height="20" border="0"></a> -->
		
		</div>


		<div class="movie-box-comment-right">
			<div class="movie-box-comment-right-top">
				<img id="img_icon_msg" src="/images/details/icon_msg.png" />
				<div class="movie-box-comment-right-bg">
				<textarea id="comment_content" name="content" onClick="checkActiveTextarea()"></textarea> 
				</div>
			</div>

			<div class="movie-box-comment-right-down">
				<div id="movie-box-comment-captcha" style="display:none;">
					{% autoescape false %}
 					<script type="text/javascript">var RecaptchaOptions = {theme : 'clean'};</script>
					{{ captchahtml }}
					{% endautoescape %}
				</div>
				<div class="movie-box-comment-name-right-bg">
					<input id="comment_author" name="author" placeholder="name"</input>
				</div>
				<a class="btn-post" type="submit" href="javascript:submitComment()" >Post</a>
			</div>
		</div>
		</form>
	</div>
</div>



  

	
<div id="comments-template">
	{% for comment in comments %}
	<div style="height:10px;"></div>
    

    <div class="comments-template-vote">
<!-- 	    <a class="btn-up" type="submit" href="javascript:;" id="{{ comment['comment'].key().id() }}" onClick="voteComment(this.id)"></a>
	    <div class="comments-vote-count">{{comment['comment'].vote_count}}</div>
	    <a class="btn-down" type="submit" href="javascript:;" id="{{ comment['comment'].key().id() }}" onClick="unvoteComment(this.id)"></a> -->
	    
	    <a class="btn-up" type="submit" href="javascript:;" id="up{{ comment['comment'].key().id() }}" onClick="voteComment({{ comment['comment'].key().id() }})"></a>
	    <div class="comments-vote-count">{{comment['comment'].vote_count}}</div>
	    <a class="btn-down" type="submit" href="javascript:;" id="down{{ comment['comment'].key().id() }}" onClick="unvoteComment({{ comment['comment'].key().id() }})"></a>

	    <script type="text/javascript">
			function checkStateVoteBtn(user_vote_state, user_voted, comment_id) {
				// alert('user_vote_state'+user_vote_state+' user_voted'+user_voted+' comment_id'+comment_id)

				if (user_vote_state == 1) {
					var arrow_up = getUpArrowDivByData(comment_id);
					arrow_up.className = 'btn-up-selected';
				};
				if (user_vote_state == -1) {
					var arrow_down = getDownArrowDivByData(comment_id);
    				arrow_down.className = 'btn-down-selected';
				};
			}

			function getUpArrowDivByData(comment_id) {
    			var up_id = 'up' + comment_id;
    			// alert(up_id)
			    var arrow_up = document.getElementById(up_id);
			    return arrow_up;
			}

			function getDownArrowDivByData(comment_id) {
				var down_id = 'down' + comment_id;
    			var arrow_down = document.getElementById(down_id);
    			return arrow_down;
			}
			checkStateVoteBtn('{{ comment['user_vote_state'] }}', '{{comment['user_voted']}}', '{{ comment['comment'].key().id() }}');
		</script>
    </div>


	<div class="comments-template-box">
		<div class="comments-template-left">
			<img id="img_avatar" width="60" height="60" src="/images/details/avatar/image_avatar{{comment['comment'].avatar_review_id}}.png" />
			<div class="comments-template-name">{{ comment['comment'].author }}</div>
		</div>


		<div class="comments-template-right">
			<div class="comments-template-count-comment">ความคิดเห็นที่ {{(movie_data.comment_count - loop.index)+1 }}</div>
			<div class="comments-template-date-and-time" id="{{comment['comment'].date}}"></div>
			<script type="text/javascript">

				function arrMonthName(m) {
					var arrMonthName = new Array("","มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม");
					 var str_day = {{comment['comment'].date.day}};
					 var str_year = {{comment['comment'].date.year}} + 543;
					 var str_time = '{{ (comment['comment'].date | datetime_lctimezone_format).strftime("%H:%M") }}น.';
					 var div = document.getElementById('{{comment['comment'].date}}');
					 div.innerHTML = str_day + ' ' + arrMonthName[m] + ' '+ str_year + ' ' +','+ ' ' + str_time;
				}

				arrMonthName({{ comment['comment'].date.month }});
				
			</script>


			<div class="comments-template-content">{{ comment['comment'].content }}</div>



		</div>
	</div>

	{% endfor %}



</div>

<div class="comments-template-box-footer"></div>






<script>
	$(document).ready(function() {
    	setupUser();
    });

	var rate_score = 0;
	// var userData;

	function setupUser() {
		// alert('setupUser')
		{% if userData %} 
		    $('#comment_author').val('{{userData.username}}')
      		$('#comment_author').attr({
            	'disabled': 'disabled'
        	})
		{% endif %}


		{% if rate_data %} 
		    rate_score = '{{ rate_data.rate_score }}';
        	// show rate if user rate this moive
        	if (rate_score !=0) {
        		setRateStar(rate_score)
        	}
		{% endif %}


		$.getJSON("/api_get_rate_movie", {'movie_id':{{ movie_data.id }}}, function(data) {
			// alert(data['data']);
			var clist = data['data'];
			var sum = 0;
			var avg = 10;
			if (clist.length > 0) {
				for(var i = 0; i < clist.length; i++){
				var c = clist[i];
				var rate_score = c['rate_score'];
    			sum += parseInt(rate_score);
				}
				avg = sum/clist.length;
			};

			// alert(avg);
			var h ='';
			h += avg
			$('.movie-rate-total').html(h);


			var hr ='';
			hr += 'Ratings : ' + avg +'/10 from ' + clist.length + ' users';
			$('.box-rate-detail').html(hr);
		});



		var hc ='';
		{% if comments %} 
			hc += 'Comments : ' + {{movie_data.comment_count}} + ' users';
		{% else %} 
			hc += 'Comments : 0 users';
		{% endif %}
		$('.box-comment-detail').html(hc);

	}




	function resetBtnPost() {
		$('.btn-post').css("background", "none repeat scroll 0 0 #999999");
		$('.btn-post').text("Post")
	}

	function alertAndResetBtn(txet) {
 		alert(txet);
 		setTimeout(resetBtnPost,0);
	}

	function submitComment() {

		$('.btn-post').css("background", "none repeat scroll 0 0 #666666");
		$('.btn-post').text("Post..")

		// var nicE = new nicEditors.findEditor('comment_content');
		// var content = nicE.getContent();


		var content = $("#comment_content").val();
		var avatar_review_id = document.getElementById('img_avatar').alt;
		var author = $("#comment_author").val();
		var recaptcha_challenge_field = $('[name="recaptcha_challenge_field"]').val();
		var recaptcha_response_field = $('[name="recaptcha_response_field"]').val();


		if (!content) {
 			alertAndResetBtn("กรุณากรอกคอมเมนต์")
 			return;
 		};
 		if (!author) {
 			alertAndResetBtn("กรุณากรอกชื่อ")
 			return;
 		};
 		if (!avatar_review_id) {
 			alertAndResetBtn("กรุณาเลือกอารมของหนัง")
 			return;
 		};


		if (document.location.hostname != "localhost") {
	 		if (!recaptcha_response_field) {
	 			alertAndResetBtn("กรุณากรอกแคปท์ชา")
	 			return;
	 		};
		}


		var postData = {'movie_id':{{ movie_data.id }},
		 				'author':author,
		  				'content':content,
		  				'avatar_review_id':avatar_review_id,
		  				'recaptcha_challenge_field':recaptcha_challenge_field,
		  				'recaptcha_response_field':recaptcha_response_field,
		  				};
		$.getJSON("/api_add_comment", postData, function(data) {
			// alert(data);

			if(data['success'] == 1){
				// TODO clear text all
				$('#comment_content').val("");				
				// nicE.setContent('');

				Recaptcha.reload();
			 	setTimeout(updateComments,100);
			}else {
				// alert(data);
				// alert("The CAPTCHA you entered is invalid. Please try again");
				alert("แคปท์ชาผิด กรุณาลองอีกครั้ง");
				Recaptcha.reload();
			}

			setTimeout(resetBtnPost,0);
		});

	}

	function updateComments() {
		$.getJSON("/api_get_comment", {'movie_id':{{ movie_data.id }}}, function(data) {
			// alert(data['data']);

			var clist = data['data'];
			var h = '';

			for (var i = 0; i < clist.length; i++) {
				var c = clist[i];
		    	var author = c['author'];
		    	var content = c['content'];
		    	var date = c['date'];
		    	var time_crate = c['time_crate'];
		    	var avatar_review_id = c['avatar_review_id'];
		    	var vote_count = c['vote_count'];
		    	var comment_id = c['comment_id'];
		    	var count_index = (clist.length)-i;
		    	// alert(avatar_review_id)

				h += '<div style="height:10px;"></div>'
    			h += '<div class="comments-template-vote">'
					h += '<a class="btn-up" type="submit" href="javascript:;" id="up'+comment_id+'" onClick="voteComment('+comment_id+')"></a>';
					h += '<div class="comments-vote-count">'+vote_count+'</div>';
    				h += '<a class="btn-down" type="submit" href="javascript:;" id="down'+comment_id+'" onClick="unvoteComment('+comment_id+')"></a>';
				h += '</div>'

    // 			h += '<div class="comments-template-vote">'
				// h += '<a class="btn-up" type="submit" href="javascript:;" id="'+comment_id+'" onClick="voteComment(this.id)"></a>';
				// h += '<div class="comments-vote-count">'+vote_count+'</div>';
    // 			h += '<a class="btn-down" type="submit" href="javascript:;" id="'+comment_id+'" onClick="unvoteComment(this.id)"></a>';
				// h += '</div>'

		    	h += '<div class="comments-template-box">';
		    		h += '<div class="comments-template-left">'; 
		    			if (avatar_review_id != 0) {
			    			h += '<img id="img_avatar" width="60" height="60" src="/images/details/avatar/image_avatar'+avatar_review_id+'.png" />';
		    			}else {h += '<img id="img_avatar" src="/images/details/avatar.png" />';};
		    			h += '<div class="comments-template-name">'+author+'</div>';
		    		h += '</div>';
		    		h += '<div class="comments-template-right">';		
						h += '<div class="comments-template-count-comment">ความคิดเห็นที่ '+count_index+'</div>';
		    			h += '<div class="comments-template-date-and-time">'+date+' , '+time_crate+'น.</div>';
		    			h += '<div class="comments-template-content">'+content+'</div>';
		    		h += '</div>';
		    	h += '</div>';
			}
			$('#comments-template').html(h);

			for (var i = 0; i < clist.length; i++) {
				var c = clist[i];
				var comment_id = c['comment_id'];
		    	var user_voted = c['user_voted'];
		    	var user_vote_state = c['user_vote_state'];
				checkStateVoteBtn(user_vote_state, user_voted, comment_id)
			}
		});
	}

	function clickAddEmo(id)	
	{
		var content = $("#comment_content").val();
		// var path_emo = '<img src="/images/details/emotion/'+id+'" border="0">'
		$('#comment_content').val(content+id);
	}

	function checkActiveTextarea(){;
		$("#movie-box-comment-captcha").show();
	}

	function clickAddAvatar(id)	
	{
		// check old id and set image select
		// <img id="img_avatar_selected" width="60" height="60" src="/images/details/avatar_selected1.png" />
		
		// img_avatar_selected1
		// var p = document.getElementById('img_avatar_1');
		// var rect = p.getBoundingClientRect();
		// if (rect)
		// 	rect.left + "px, " + rect.top
		// alert($('#img_avatar').attr("alt"));


		// var oldAvatar = $('#img_avatar').attr("alt");
		// // alert(oldAvatar);

		// if (oldAvatar == id) {
		// 	alert('cancel');
		// };

		

		$('#img_avatar').attr("src", "/images/details/avatar/image_avatar"+id+".png");
		$('#img_avatar').attr("alt", id);

		// setFadeAnimation(true ,true);
		
		// $('#img_avatar_selected1').attr("src", "/images/details/avatar/avatar_selected1.png");

	}

	function setFadeAnimation(firstime, state) {
		// alert('setFadeAnimation');
		// $("#img_avatar").fadeToggle();

		if (firstime) {
			$("#img_avatar").fadeToggle(1500, function() { setFadeAnimation(false ,false)});
		}else{
			if (state) {
  				$("#img_avatar").fadeToggle(1500, function() { setFadeAnimation(false ,false)});
  			}else{
  				// $("#img_avatar").fadeToggle("slow");
  				$("#img_avatar2").fadeOut(1500, function() { setFadeAnimation(false ,true)});
  			}
		}
  		// $("#div3").fadeToggle(3000);
	}


	function voteComment(id) {
		// check user vote
		{% if userData %} 
			var postData = {'comment_id':id,
						'user_id':{{userData.user_id}},
						'movie_id':{{movie_data.id}}
		  				};
		  // user_id
			$.getJSON("/api_vote_comment", postData, function(data) {
				if(data['success'] == 1){
					setTimeout(updateComments,100);
					alert('vote complete')				
				}else {
					alert('vote not complete')				
				}
			});
		{% else %}
			showLoginDialog()
		{% endif %}
	}


	function unvoteComment(id) {
		{% if userData %} 
			var postData = {'comment_id':id,
						'user_id':{{userData.user_id}},
						'movie_id':{{movie_data.id}}
		  				};
		 	$.getJSON("/api_unvote_comment", postData, function(data) {
				if(data['success'] == 1){
				setTimeout(updateComments,100);
				alert('unvote complete')				
				}else {
				alert('unvote not complete')				
				}
			});
		{% else %}
			showLoginDialog()
		{% endif %}
	}


	function setRateStar(alt) {
		// alert(alt)
		alt+1;
		var abc = alt;
		for (var i=1; i <= alt ;i++)
		{ 
			document.getElementById('star-'+[i]).src='/images/details/rate/pink_star_40x38.png';
		}
		document.getElementById("rate-select").innerHTML = abc+'/10';
	}

	function showRateStar(alt) {
		alt+1;
		var count_rate = alt;

		// var rate_score = {{ rate_data.rate_score }};
		if (rate_score == 0) {
			for (var i=1; i <= alt ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/black_star_40x38.png';
			}
			document.getElementById("rate-select").innerHTML = count_rate+'/10';
		}else{
			for (var i=1; i <= 10 ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/grey_star_40x38.png';
			}
			for (var i=1; i <= alt ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/black_star_40x38.png';
			}
			document.getElementById("rate-select").innerHTML = count_rate+'/10';
		}
	}

	function hideRateStar() {
		// alert('hideRateStar')
		// if user vote 
		// show rate vote 
		
		if (rate_score == 0) {
			
			for (var i=1; i <= 10 ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/grey_star_40x38.png';
			}
			document.getElementById("rate-select").innerHTML = '-/10';
		}else{
			for (var i=1; i <= 10 ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/grey_star_40x38.png';
			}
			for (var i=1; i <= rate_score ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/pink_star_40x38.png';
			}

			document.getElementById("rate-select").innerHTML = rate_score+'/10';
		}
	}


	function clickRate(alt)	{
		// alert(alt)

		{% if userData %}
			alt+1;
			var count_rate = alt;
			for (var i=1; i <= alt ;i++)
			{ 
				document.getElementById('star-'+[i]).src='/images/details/rate/pink_star_40x38.png';
			}
			document.getElementById("rate-select").innerHTML = count_rate+'/10';

			var user_id = {{userData.user_id}};
	 		var username = '{{userData.username}}';

			addRate(alt, user_id, username);
		{% else %}
			showLoginDialog()
		{% endif %}
	}


	function addRate(score, user_id, username) {
		//TODO
		var postData = {'movie_id':{{ movie_data.id }},
		 				'user_id':user_id,
		  				'username':username,
		  				'rate_score':score,
		  				};
		$.getJSON("/api_add_rate_movie", postData, function(data) {
			if(data['success'] == 1){
				alert("rate movie complete");
				// update ui
				rate_score = score;
				setRateStar(score)
			}else {
				alert("rate movie not complete");
			}
		});
	}



</script>

{% include "/main_footer.html" with context %}

</body>

</html>
{% endautoescape %}