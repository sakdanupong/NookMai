<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
{% autoescape true %}
<html>
<head>
	<!-- <link rel="shortcut icon" href="images/favicon.ico" /> -->
	<!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css"> -->
	<script src="/javascripts/LoginDialog.js"></script>
    <script src="/javascripts/CookieUtils.js"></script>
  	<script src="/javascripts/md5.min.js"></script>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <script src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link type="text/css" rel="stylesheet" href="/stylesheets/main_header.css" />
<script>

	function scrollToDiv(element) {
		// $("*").animate({ scrollTop: 0}, { duration: 'slow', easing: 'swing'});
		var p = document.getElementById(element);
		if (p)
			$("*").animate({ scrollTop: p.offsetTop}, { duration: 'slow', easing: 'swing'});
		else {
			var params = {
				'scroll_to' : element,
			};
			post_to_url(params)
		}
	}

	function post_to_url(params) {
	    var method = "post"; // Set method to post by default if not specified.

	    // The rest of this code assumes you are not using a library.
	    // It can be made less wordy if you use one.
	    var form = document.createElement("form");
	    form.setAttribute("method", method);
	    form.setAttribute("action", '/');

	    for(var key in params) {
	        if(params.hasOwnProperty(key)) {
	            var hiddenField = document.createElement("input");
	            hiddenField.setAttribute("type", "hidden");
	            hiddenField.setAttribute("name", key);
	            hiddenField.setAttribute("value", params[key]);

	            form.appendChild(hiddenField);
	         }
	    }

	    document.body.appendChild(form);
	    form.submit();
	}

	function readyToSearchMovie() {
		var search_input = $("#search_input");
    	search_input.autocomplete({
	    	source: function (request, response) {
		    	var word = $("#search_input").val();
				var formData = new FormData();
          		formData.append('word', word);	
	    		$.ajax({
            		url: '/api_get_searchmovie',  //Server script to process data
            		type: 'POST',
            		mimeType:"multipart/form-data",
            		dataType: 'json',
            		success: function(json) {
              			//response(data);
              			// alert('word');
            		},
            		data: formData,
            		cache: false,
            		contentType: false,
            		processData: false
         		 });
    		},
    		minLength: 2
		});
	}

	function showLoginDialog() {
      LoginDialog(function(success, data, reason, logindialog) {
        if (success) {
             var user_id = data['user_id'];
             var username = data['username'];
             var email = data['email'];
             var session_token = data['session_token'];
             setCookie('session_token', session_token, ExpireDayCookie(30));             
             logindialog.dismissLoginDialog();
             setTimeout(function() {
              location.reload();
             } , 700);
          } else {
            alert(reason);
          }
      } , function(success, data, reason, logindialog) {
        if (success) {
             var user_id = data['user_id'];
             var username = data['username'];
             var email = data['email'];
             var session_token = data['session_token'];
             setCookie('session_token', session_token, ExpireDayCookie(30));
             logindialog.dismissLoginDialog();
             setTimeout(function() {
				      location.reload();
			       } , 700);
          } else {
            alert(reason);
          }
      });
    }

	function logout() {
		removeCookie('session_token');
		location.reload();	
	}


    function hideAllUserDiv() {
    	var login_div = $('#login_div');
    	var user_div = $('#user_div');
    	login_div.hide();
    	user_div.hide();
    }

    function checkSession() {
    	hideAllUserDiv();
    	var login_div = $('#login_div');
    	var user_div = $('#user_div');
    	var label = $('#username_label');
    	var session_token = getCookie('session_token');
    	if (session_token) {
    		var formData = new FormData();
    		formData.append('session_token', session_token);

		$.ajax({
            url: '/api_get_userdata',  //Server script to process data
            type: 'POST',
            mimeType:"multipart/form-data",
            dataType: 'json',
            success: function(json) {
              var success = json['success'];
              var data = json['data'];
              var reason = json['reason'];
              if (success) {
              	var username = data['username'];
              	user_div.show();
              	label.text(username);
              } else {
              	removeCookie('session_token');
              	login_div.show();
              }
              	
            },
            data: formData,
            cache: false,
            contentType: false,
            processData: false
          });
    	} else {
    		login_div.show();
    	}
    }

	$(document).ready(function() {
    	readyToSearchMovie();
    	checkSession();
    });

</script>
</head>
<body>
	<!-- <div id="header_div">
		<div class="col-md-4">
			<img id="img_header_logo" src="/images/headers/logo1.png" />
		</div>
		<div class="col-md-4"></div>
		<div class="col-md-4">
			<input id="search_input" type="text" placeholder="Search movies"/>
			<img id="img_search" src="/images/headers/icon_search.png"/>
		</div>
	</div>
	<div id="nav_div">
	</div> -->
	<div id="header_div">
		<a href="/"><img id="img_header_logo" src="/images/headers/logo1.png" /></a>
		<div class="round-corner" id="search_div">
			<div class="ui-widget"><input id="search_input" placeholder="Search movies" onchange="readyToSearchMovie();"></div>
			<!-- <input id="search_input" type="text" /> -->
			<img id="img_search" src="/images/headers/icon_search.png"/>
		</div>
	</div>
	<div id="nav_div">
		<div id="inner_nav_div">
			<ul><li><a id="nav_home" class="round-corner" href="/">Home</a></li>
				<li><a id="nav_now_showing" class="round-corner" href="javascript:scrollToDiv('nowshowing_div')">Now Showing</a></li>
				<li><a id="nav_coming_soon" class="round-corner" href="javascript:scrollToDiv('comingsoon_div')">Coming Soon</a></li>
				<li><a id="nav_about" class="round-corner" href="/about">About</a>
				</li>
			</ul>
		</div>
	</div>
	<div id="username_div">
		<div class="username_inner_div" id="login_div"><input type="submit" onClick="showLoginDialog()" value="Login"></input></div>
		<div class="username_inner_div" id="user_div"><label id="username_label"></label><input type="submit" onClick="logout()" value="Logout"></input></div>
   	</div>
	
</body>
</html>
{% endautoescape %}